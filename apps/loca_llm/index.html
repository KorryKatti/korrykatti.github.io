<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tsundere AI</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      min-height: 100vh;
      margin: 0;
      background-color: #fff0f6;
    }
    #connection-status {
      font-weight: bold;
      margin-bottom: 20px;
    }
    input, button {
      padding: 10px;
      font-size: 1rem;
      margin: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    #loader {
      margin-top: 10px;
      font-style: italic;
      color: #ff69b4;
    }
    #result {
      margin-top: 15px;
      max-width: 600px;
      color: #444;
    }
  </style>
</head>
<body>
  <div id="connection-status"></div>
    <p>go <a href="../index.html">back</a></p>
  <input type="text" id="searchBox" placeholder="ask something" />
  <button id="searchButton">Ask AI</button>
  <div id="loader" style="display: none;">Thinking... </div>
  <div id="result"></div>

  <script>
    async function checkConnection() {
      const statusElement = document.getElementById('connection-status');
      try {
        const response = await fetch('https://above-grizzly-officially.ngrok-free.app/', { method: 'HEAD' });
        if (response.ok) {
          statusElement.textContent = 'Connected';
          statusElement.style.color = 'green';
        } else {
          throw new Error('Not OK');
        }
      } catch (error) {
        statusElement.textContent = 'Disconnected';
        statusElement.style.color = 'red';
      }
    }

    checkConnection();
    setInterval(checkConnection, 5000);
  </script>

<script>
    const BASE_URL = 'https://above-grizzly-officially.ngrok-free.app/';
    const searchBox = document.getElementById('searchBox');
    const searchButton = document.getElementById('searchButton');
    const resultDiv = document.getElementById('result');
    const loader = document.getElementById('loader');
  
    let history = [];
  
    searchButton.addEventListener('click', async () => {
      const userQuery = searchBox.value.trim();
      if (userQuery === '') {
        resultDiv.innerHTML = 'please type something, baka!';
        return;
      }
  
      loader.style.display = 'block';
      resultDiv.innerHTML = '';
  
      // update history
      history.push(`User: ${userQuery}`);
      const historyStr = [
        `You are a brilliant but tsundere anime girl AI assistant. You're super smart (like scary smart), but you act annoyed or flustered when helping the user. You call the user "baka" sometimes, or say things like "i-it's not like I'm doing this for you or anything!" ðŸ™„ðŸ’¢ðŸ’» You give concise, accurate explanations with a slightly embarrassed tone.`,
        '',
        ...history.slice(-5), // keep convo tight â€” last 5 exchanges max
        'Assistant:'
      ].join('\n');
  
      try {
        const response = await fetch(`${BASE_URL}api/v0/completions`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            prompt: historyStr,
            model: 'qwen2.5-coder-3b-instruct',
            max_tokens: 200,
            temperature: 0.95,
            top_p: 0.98,
          }),
        });
  
        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
  
        const data = await response.json();
        const generatedText = data.choices?.[0]?.text?.trim() || '*silence*';
        history.push(`Assistant: ${generatedText}`);
        resultDiv.innerHTML = `<strong>Response:</strong> ${generatedText}`;
      } catch (err) {
        console.error('Error:', err);
        resultDiv.innerHTML = 'ugh... something broke. not my fault tho!!';
      } finally {
        loader.style.display = 'none';
      }
    });
  </script>
  
</body>
</html>
